<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Informe de Donaciones</title>

  <!-- Bootstrap & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <!-- Custom -->
  <link rel="stylesheet" th:href="@{/css/styles.css}">

  <style>
    .fade-in {
      opacity: 0;
      transform: translateY(10px);
      transition: opacity 0.6s ease, transform 0.6s ease;
    }
    .fade-in.show {
      opacity: 1;
      transform: translateY(0);
    }
    .section-title i {
      color: var(--bs-primary);
    }
    .edit-input {
      width: 140px;
      font-size: 0.85rem;
      background: var(--surface);
      color: var(--bs-body-color);
      border: 1px solid rgba(255,255,255,.15);
      border-radius: .4rem;
      padding: .25rem .5rem;
    }
  </style>
</head>

<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark navbar-blur border-bottom border-secondary sticky-top" th:replace="~{index :: nav}"></nav>

  <main class="container page-wrap fade-in">
    <div class="card shadow-lg p-4 border-0">
      <h1 class="text-center mb-4 text-primary d-flex align-items-center justify-content-center gap-2">
        <i class="bi bi-bar-chart-line"></i> Informe de Donaciones
      </h1>

      <div class="row g-5">
        <!-- Panel izquierdo -->
        <div class="col-md-4">
          <!-- Filtros -->
          <div class="card action-card p-4 mb-4">
            <h5 class="section-title mb-3"><i class="bi bi-funnel"></i> Filtros de búsqueda</h5>

            <form th:action="@{/informes/donaciones/consultar}" method="get">
              <div class="mb-3">
                <label for="categoria" class="form-label">Categoría</label>
                <select class="form-select" id="categoria" name="categoria">
                  <option value="">-- Todas --</option>
                  <option value="ALIMENTOS" th:selected="${param.categoria == 'ALIMENTOS'}">Alimentos</option>
                  <option value="ROPA" th:selected="${param.categoria == 'ROPA'}">Ropa</option>
                  <option value="JUGUETES" th:selected="${param.categoria == 'JUGUETES'}">Juguetes</option>
                  <option value="UTILES_ESCOLARES" th:selected="${param.categoria == 'UTILES_ESCOLARES'}">Útiles Escolares</option>
                </select>
              </div>

              <div class="row">
                <div class="col-6 mb-3">
                  <label for="fechaInicio" class="form-label">Desde</label>
                  <input type="date" class="form-control" id="fechaInicio" name="fechaInicio" th:value="${param.fechaInicio}">
                </div>
                <div class="col-6 mb-3">
                  <label for="fechaFin" class="form-label">Hasta</label>
                  <input type="date" class="form-control" id="fechaFin" name="fechaFin" th:value="${param.fechaFin}">
                </div>
              </div>

              <div class="mb-4">
                <label for="eliminado" class="form-label">Eliminado</label>
                <select class="form-select" id="eliminado" name="eliminado">
                  <option value="">-- Ambos --</option>
                  <option value="si" th:selected="${param.eliminado == 'si'}">Sí</option>
                  <option value="no" th:selected="${param.eliminado == 'no'}">No</option>
                </select>
              </div>

              <button type="submit" class="btn btn-primary w-100 btn-action d-flex align-items-center justify-content-center gap-2">
                <i class="bi bi-search"></i><span>Consultar</span>
              </button>
            </form>
          </div>

          <!-- Guardar filtro -->
          <div class="card action-card p-4 mb-4">
            <h5 class="section-title mb-3"><i class="bi bi-save"></i> Guardar filtro actual</h5>
            <form th:action="@{/informes/donaciones/filtros/guardar}" method="post">
              <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
              <input type="hidden" name="categoria" th:value="${param.categoria}">
              <input type="hidden" name="fechaInicio" th:value="${param.fechaInicio}">
              <input type="hidden" name="fechaFin" th:value="${param.fechaFin}">
              <input type="hidden" name="eliminado" th:value="${param.eliminado}">
              <div class="mb-3">
                <label for="nombreFiltro" class="form-label">Nombre del filtro</label>
                <input type="text" class="form-control" id="nombreFiltro" name="nombreFiltro" placeholder="Ej: Octubre Activos" required>
              </div>
              <button type="submit" class="btn btn-outline-success w-100 btn-action d-flex align-items-center justify-content-center gap-2">
                <i class="bi bi-check2-circle"></i><span>Guardar</span>
              </button>
            </form>
          </div>

          <!-- Filtros guardados -->
          <div class="card action-card p-4">
            <h5 class="section-title mb-3"><i class="bi bi-archive"></i> Filtros guardados</h5>
            <div th:if="${filtrosGuardados == null or #lists.isEmpty(filtrosGuardados)}">
              <p class="text-secondary">No hay filtros guardados todavía.</p>
            </div>

            <div th:if="${filtrosGuardados != null and not #lists.isEmpty(filtrosGuardados)}">
              <table class="table table-dark-modern table-sm align-middle mt-2">
                <thead>
                  <tr>
                    <th>Nombre</th>
                    <th class="text-center">Acciones</th>
                  </tr>
                </thead>
                <tbody>
                  <tr th:each="f : ${filtrosGuardados}">
                    <td th:text="${f.nombre}" class="fw-semibold">Ejemplo</td>
                    <td>
  <div class="d-flex flex-column align-items-center gap-2">
    <!-- Aplicar / Eliminar -->
    <div class="d-flex gap-2">
      <a ... class="btn btn-sm btn-outline-primary"><i class="bi bi-play"></i></a>
      <form ... class="d-inline">
        <button class="btn btn-sm btn-outline-danger"><i class="bi bi-trash"></i></button>
      </form>
    </div>

    <!-- Editar -->
    <form ... class="d-flex align-items-center gap-2 mt-1 flex-nowrap">
      <input type="text" name="nuevoNombre" class="edit-input flex-grow-1" placeholder="Nuevo nombre" required>
      <button type="submit" class="btn btn-sm btn-outline-warning">
        <i class="bi bi-pencil-square"></i>
      </button>
    </form>
  </div>
</td>

                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Panel derecho -->
        <div class="col-md-8">
          <div class="card action-card p-4 h-100">
            <h5 class="section-title mb-4"><i class="bi bi-table"></i> Resultados</h5>

            <div th:if="${resultados == null}">
              <p class="text-secondary fst-italic">Realice una consulta para ver los resultados.</p>
            </div>

            <div th:if="${resultados != null}">
              <div th:if="${#lists.isEmpty(resultados)}" class="alert alert-modern text-warning text-center">
                <i class="bi bi-exclamation-triangle"></i> No se encontraron resultados para los filtros aplicados.
              </div>

              <table class="table table-dark-modern table-hover text-center" th:if="${not #lists.isEmpty(resultados)}">
                <thead>
                  <tr>
                    <th>Categoría</th>
                    <th>Total Recibido/Donado</th>
                    <th>Eliminado</th>
                  </tr>
                </thead>
                <tbody>
                  <tr th:each="r : ${resultados}">
                    <td th:text="${r.categoria}">ALIMENTOS</td>
                    <td th:text="${r.totalCantidad}">10</td>
                    <td>
                      <span th:text="${r.eliminado} ? 'Sí' : 'No'"
                            th:classappend="${r.eliminado} ? 'badge bg-danger' : 'badge bg-success'">
                        No
                      </span>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <footer class="mt-5 py-3 text-center text-secondary border-top border-secondary">
      <small><i class="bi bi-code-slash text-primary"></i> Grupo N — Desarrollo de Software en Sistemas Distribuidos</small>
    </footer>
  </main>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      document.querySelector(".fade-in").classList.add("show");
    });
  </script>
</body>
</html>
